# Running Hadoop and Spark in Swarm cluster

# Prerequisites
 - docker (version 18.0 or higher)
 - docker-compose


# Usage

## 1 Swarm manager
To initialize the swarm setup run:
```
docker swarm init
```
Your system will be the Swarm manager node. Take a note o the token generated by this command. You will use this token if you want to add other nodes to the Swarm cluster.


## 2 Create an overlay and cluster networks
```
docker network create --ingress --driver overlay ingress
docker network create -d overlay --attachable spark-net
```
## 3 Create services
To deploy Spark and Hadoop services run:
```
docker stack deploy -c spark-swarm.yml spark
```

# Scaling the services
In order to have 4 Spark worker nodes run:
```
docker service scale spark_worker=4
```
# Info about the services
```
docker stack ls
```
```
docker stack services spark
```
```
docker service ls
```
```
docker network inspect docker_gwbridge | egrep 'Name|IPv4>
```

# Stopping the services
```
docker stack rm spark
```

# Debugging

You can check the logs
```
docker logs -f container_name
```

The container name can be found by
```
docker ps
```
